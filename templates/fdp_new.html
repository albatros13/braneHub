{% extends 'base.html' %}
{% block title %}Start FDP Project Â· BraneHub{% endblock %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10 col-xl-9">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h4 mb-0">Start a Federated Data Access Project</h1>
      <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">Back to Dashboard</a>
    </div>

    <div class="card shadow-sm">
      <div class="card-body">
        {% if error %}
          <div class="alert alert-danger" role="alert">{{ error }}</div>
        {% endif %}
        <form method="post" action="{{ url_for('fdp_new') }}">
          <div class="row g-3">
            <div class="col-md-8">
              <label for="title" class="form-label">Project Title</label>
              <input type="text" class="form-control" id="title" name="title" required>
            </div>
            <div class="col-md-4">
              <label for="email" class="form-label">Contact Email</label>
              <input type="email" class="form-control" id="email" name="email" required>
            </div>
            <div class="col-md-8">
              <label for="institution" class="form-label">Research Institution</label>
              <input type="text" class="form-control" id="institution" name="institution" required>
            </div>
            <div class="col-12">
              <label for="objective" class="form-label">Study Objective</label>
              <textarea class="form-control" id="objective" name="objective" rows="3" placeholder="Describe the purpose of the data processing" required></textarea>
            </div>

            <div class="col-md-6">
              <label for="data_types" class="form-label">Data Types Required</label>
              <select id="data_types" name="data_types" class="form-select" multiple size="5" aria-describedby="dataTypesHelp">
                {% for opt in data_types_options %}
                  <option value="{{ opt }}">{{ opt }}</option>
                {% endfor %}
              </select>
              <div id="dataTypesHelp" class="form-text">Select all that apply. Examples include imaging, EHR, genomics.</div>
            </div>

            <div class="col-md-6">
              <label class="form-label d-block">Data Sensitivity Level</label>
              <div class="btn-group" role="group" aria-label="Sensitivity">
                <input type="radio" class="btn-check" name="sensitivity" id="sensLow" value="Low" autocomplete="off">
                <label class="btn btn-outline-secondary" for="sensLow">Low</label>
                <input type="radio" class="btn-check" name="sensitivity" id="sensMed" value="Medium" autocomplete="off" checked>
                <label class="btn btn-outline-secondary" for="sensMed">Medium</label>
                <input type="radio" class="btn-check" name="sensitivity" id="sensHigh" value="High" autocomplete="off">
                <label class="btn btn-outline-secondary" for="sensHigh">High</label>
              </div>
              <div class="form-text">Determines consent requirements or additional safeguards.</div>
            </div>

            <div class="col-md-6">
              <label class="form-label">Security Measures Planned</label>
              <div class="row row-cols-1 row-cols-sm-2 g-2">
                {% for opt in security_measures_options %}
                <div class="col">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="{{ opt }}" id="sec_{{ loop.index }}" name="security_measures">
                    <label class="form-check-label" for="sec_{{ loop.index }}">{{ opt }}</label>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>

            <div class="col-md-6">
              <label for="legal_basis" class="form-label">Legal Basis for Data Processing</label>
              <select id="legal_basis" name="legal_basis" class="form-select">
                <option value="" selected>Choose...</option>
                {% for opt in legal_basis_options %}
                  <option value="{{ opt }}">{{ opt }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label d-block">Third-party Collaboration</label>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="third_party" id="tpNo" value="no" checked>
                <label class="form-check-label" for="tpNo">No</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="third_party" id="tpYes" value="yes">
                <label class="form-check-label" for="tpYes">Yes</label>
              </div>
            </div>

            <div class="col-12">
              <label for="result_sharing" class="form-label">Result Sharing Policy</label>
              <textarea class="form-control" id="result_sharing" name="result_sharing" rows="3" placeholder="Will models or aggregated statistics be shared externally?"></textarea>
            </div>
            <div class="col-12">
              <label for="responsibilities" class="form-label">Participant Responsibilities</label>
              <textarea class="form-control" id="responsibilities" name="responsibilities" rows="3" placeholder="E.g., adherence to access policies, logging, and operational obligations."></textarea>
            </div>
          </div>

          <div class="d-flex justify-content-end gap-2 mt-4">
            <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">Cancel</a>
            <button type="submit" class="btn btn-primary">Create FDP Project</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}