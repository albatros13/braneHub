{% extends 'base.html' %}
{% block title %}Preview OPA input · BraneHub{% endblock %}
{% block content %}
<div class="row mb-3">
  <div class="col-12 d-flex justify-content-between align-items-center">
    <div>
      <a href="{{ url_for('onboarding_request_detail', req_id=req._id) }}" class="text-decoration-none">← Back to Request</a>
      <h1 class="h4 mt-2 mb-0">Preview OPA input</h1>
      <div class="text-muted small">Project: {{ project.title }} ({{ project.id }}) · Applicant: {{ req.username }}</div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css">
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" data-autoloader-path="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/"></script>

<div class="row g-4">
  <div class="col-12 col-xl-6">
    {% set id = 'opa_input' %}
    {% set title = 'OPA input (JSON)' %}
    {% set language = 'json' %}
    {% set content = opa_input_pretty %}
    {% set download_href = opa_input_download_href %}
    {% include 'partials/code_preview.html' %}
  </div>
  <div class="col-12 col-xl-6">
    {% set id = 'rego_policy' %}
    {% set title = policy_title or 'Policy' %}
    {% set language = 'rego' %}
    {% set content = rego_policy_content %}
    {% set download_href = rego_download_href %}
    {% include 'partials/code_preview.html' %}
    <div class="mt-2 text-muted small">Source: <a href="{{ rego_download_href }}" target="_blank">{{ policy_source_path or 'static/data/policies/policy.rego' }}</a></div>
  </div>
</div>
{% endblock %}
